var fs = require('fs')
var render = require('json-templater/string')
var path = require('path')

function resolve (dir) {
  return path.join(__dirname, '../../src/configs', dir)
}

var Components = require(resolve('SystemConfiguration.json'))
var OUTPUT_PATH = resolve('errorCode.js')
var IMPORT_TEMPLATE = '\'{{name}}\': {\'code\': \'{{code}}\', \'msg\': \'{{msg}}\'}'

var MAIN_TEMPLATE = `/* Automatically generated by './build/bin/SystemConfiguration.js' */
export default {
  {{include}}
}`;

var ComponentNames = Components // Object.keys(Components);

var includeComponentTemplate = [];

ComponentNames.errorCode.forEach(val => {
  includeComponentTemplate.push(render(IMPORT_TEMPLATE, {
    name:val.exceptionName,
    code: val.code,
    msg: val.msg
  }));

});
var template = render(MAIN_TEMPLATE, {
  include: includeComponentTemplate.join(',\n  ')
});

fs.writeFileSync(OUTPUT_PATH, template);
console.log('[build entry] DONE:', OUTPUT_PATH);

