<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="divport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1.0, user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <meta name="format-detection" content="telephone=no"/>
    <title></title>
</head>
<body>
<script type="text/javascript" src="./js/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="./js/common.js"></script>
<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script>
<script>
    window.onload = function () {
        var success = getPar('success');
        var msg = getPar('msg');
        var data = getPar('data');
        if (success) {
            getCustomerInfo(data)
        } else {
            // 跳转错误页
            alert(msg)
        }
    }

    function getCustomerInfo(encryptNascentId) {
        var recruitInfo = JSON.parse(localStorage.getItem('recruitInfo'));
        $.ajax({
            url: backstageURL + '/getCustomerInfo',
            type: 'post',
            data: {
                guideId: recruitInfo.guideId,
                shopId: recruitInfo.shopId,
                brandId: recruitInfo.brandId,
                encryptNascentId: encryptNascentId
            },
            dataType: 'json',
            success: function (result) {
                if (result.success) {
                    // 根据数据状态跳转不同页面
                    alert(JSON.stringify(result.result))
                    if(result.result.newMember){
                        // 调用微信官方开卡界面
                        wx.navigateToMiniProgram({
                            appId: 'wxeb490c6f9b154ef9', // 固定为此appid，不可改动
                             extraData: data, // 包括encrypt_card_id outer_str biz三个字段，须从step3中获得的链接中获取参数
                             success: function() {

                             },
                            fail: function() {

                            },
                            complete: function() {

                            }
                        })
                    }else{
                        //

                    }


                } else {
                    // 跳转错误页
                    alert(result.msg)
                }
            }
        })
    }

</script>
</body>
</html>
