<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="divport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1.0, user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <meta name="format-detection" content="telephone=no"/>
    <title></title>
</head>
<body>
<script type="text/javascript" src="./js/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="./js/common.js"></script>
<script>
  window.onload = function () {
    var recruitEntity
      getAuth()
      //checkGuide()
    alert(localStorage.getItem('recruitInfo').toString())
  }

  function checkGuide () {
    recruitEntity = {
      guideId: getPar('guideId'),
      shopId: getPar('shopId'),
      brandId: getPar('brandId')
    }
    localStorage.setItem('recruitInfo', JSON.stringify(recruitEntity))
    alert(localStorage.getItem('recruitInfo').toString())
    $.ajax({
      url: backstageURL + '/checkGuide',
      type: 'post',
      data: {
        guideId: getPar('guideId'),
        shopId: getPar('shopId'),
        brandId: getPar('brandId')
      },
      dataType: 'json',
      success: function (result) {
        if(result.success){
          // 跳转授权地址
          getAuth()
        }else{
          // 跳转错误页
          alert(result.msg)
        }
      }
    })
  }

  function getAuth () {
    let authUrl
    // $.ajax({
    //   url: backstageURL + '/getAuthURl',
    //   type: 'post',
    //   data: { redirectUrl: getRootPath() + '/checkCustomer.html', platform: '2' },
    //   dataType: 'JSON',
    //   contentType:'application/json;charset=utf-8',
    //   success: function (data) {
    //     authUrl = data.result
    //     window.location.replace(authUrl)
    //   }
    // })

      this.ajax(backstageURL + '/getAuthURl',{platform: '2' }).then(function(data){
          window.location.replace(data.result)
      })
  }

  function ajax(url, data, params) {
      data = JSON.stringify(data)
      return new Promise(function(resolve, reject) {
          $.ajax({
              url: url,
              type: params && params.type || 'post',
              dataType: params && params.dataType || 'JSON',
              data: data,
              method:"post",
              contentType: "application/json;charset=UTF-8",
              success: function(res) {
                  resolve(res)
              },
              error: function(res) {
                  alert(res.m)
              }
          });
      });

  }
</script>
</body>
</html>
