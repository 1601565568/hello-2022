<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=2.0, user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <meta name="format-detection" content="telephone=no"/>
    <link rel="stylesheet" href="./memberCard.css">
    <title>会员卡</title>
</head>
<body>
<div class="membercard">
    <div class="membercard__header">
        <div class="card">
            <div class="card__message">
                <!-- 默认图片 -->
                <img id="groupImage" src="../img/expression/memberDefault.png" alt="品牌LOGO" class="defaultimg">
                <div class="store">
                    <div class="store__name">
                        <div id="groupName" class="name"></div>
                        <div class="grade">
                            <img src="../img/icons/vip.png" alt="会员等级">
                            <text id="memberGrade" class="grade__level">1</text>
                        </div>
                    </div>
                    <div id="shopName" class="store__address"></div>
                </div>
                <div class="qrcode" onclick="toNewCode()">
                    <img src="../img/icons/QRcode.png" alt="二维码">
                </div>
            </div>
            <div id="memberCard" class="card__number"></div>
        </div>
    </div>
    <div class="membercard__content">
        <div class="content">
            <div class="content__msg">Dear，你已经有绑定导购啦！</div>
            <div class="content__division">
                <div class="division">
                    <div class="division__line"></div>
                    <div class="division__circle division__circle--left"></div>
                    <div class="division__circle division__circle--right"></div>
                </div>
            </div>
            <div class="content__qrcode">
                <img id ="guideQrCode" src="../img/expression/memberQrcode.png" alt="二维码" class="qrcodeimg">
            </div>
            <div class="content__chat">长按识别二维码进行聊天</div>
        </div>
    </div>
</div>
<script type="text/javascript" src="../js/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="../js/common.js"></script>
<script>
    $(function () {
        var showData = JSON.parse(localStorage.getItem('showData'));
        if (showData) {
            console.log(JSON.stringify(showData).toString())
            $('#memberGrade').html(showData.memberGrade);
            $('#shopName').html(showData.shopName);
            $('#groupName').html(showData.groupName);
            if(showData.groupImage){
                $('#groupImage').attr('src',showData.groupImage);
            }
            $('#memberCard').html(showData.memberCard.replace(/(.{4})/g,'$1 '));
            if(showData.cardUrl){
                $('#guideQrCode').attr('src', showData.cardUrl)
            }
        }
    })

    function toNewCode() {
        window.location.replace("../newCode/newCode.html");
    }

    function toCustomerCenter() {
        var recruitInfo = JSON.parse(localStorage.getItem('recruitInfo'));
        // 获取e互动店铺
        this.ajax(backstageURL + '/getEHDShopId',{
            guideId: recruitInfo.guideId,
            shopId: recruitInfo.shopId,
            groupId: recruitInfo.groupId,
        }).then(function(data){
            window.location.replace("http://ehd.vecrp.com/shop"+data.result+"/wx55/home")
        })
    }

    function ajax(url, data, params) {
        data = JSON.stringify(data)
        return new Promise(function(resolve, reject) {
            $.ajax({
                url: url,
                type: params && params.type || 'post',
                dataType: params && params.dataType || 'JSON',
                data: data,
                method:"post",
                contentType: "application/json;charset=UTF-8",
                success: function(res) {
                    resolve(res)
                },
                error: function(res) {
                    alert(res.m)
                }
            });
        });
    }
</script>
</body>
</html>
