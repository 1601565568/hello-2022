<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=2.0, user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <meta name="format-detection" content="telephone=no"/>
    <link rel="stylesheet" href="./invalid/invalid.css">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title></title>
</head>
<script type="text/javascript" src="../js/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="../js/common.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script>
<body>
  <div style="width:100%;height: 100%;display: flex;justify-content: center;">
    <div style="display: flex;flex-direction: column;align-items: center;justify-content: center;">
      <div>
        <button class="btn" onclick="sendLink()">发送招募链接</button>
      </div>
    </div>
  </div>
</body>
<script>
    function sendLink () {
      wx.invoke('sendChatMessage', {
        msgtype:"text", //消息类型，必填
        text: {
          content:"你好", //文本内容
        }
      }, function(res) {
        if (res.err_msg == 'sendChatMessage:ok') {
          //发送成功
          alert("发送成功")
        }else {
          alert("发送失败")
        }
      })
    }
    window.onload = function () {
        getUserId(),
        getConfig()
    }
    function getConfig() {
      var url = window.location.href.split('#')[0];
      let groupId = getPar("groupId");
      let appid = getPar("appid");
      this.ajax(backstageURL() + '/wework/getConfig', {
        url: url,
        groupId: groupId,
        appId: appid
      }).then(function (result) {
        debugger
        if (result.success) {
          console.log("wx.config() ---> 接收后台返回的参数");
          wx.config({
            debug: true,
            appId: result.result.appid,
            timestamp: result.result.timestamp,
            nonceStr: result.result.nonceStr,
            signature: result.result.signature,
            jsApiList: ['onMenuShareAppMessage','sendChatMessage']
          })
        } else {
        }
      })
    }
    function getUserId() {
      let groupId = getPar("groupId");
      let code = getPar("code");
      this.ajax(backstageURL() + '/wework/getUserId', {
        groupId: groupId,
        code: code
      }).then(function (result) {
          if (result.success) {

          } else {
          }
      })
    }
    function ajax(url, data, params) {
        data = JSON.stringify(data)
        return new Promise(function (resolve, reject) {
            $.ajax({
                url: url,
                type: params && params.type || 'post',
                dataType: params && params.dataType || 'JSON',
                data: data,
                method: "post",
                contentType: "application/json;charset=UTF-8",
                success: function (res) {
                    resolve(res)
                },
                error: function (res) {
                    $(".fail").show();
                    $('.fail__text').html(result.msg);
                }
            });
        });
    }
</script>
<style>
  .btn{
    display: inline-block;
    line-height: 1;
    white-space: nowrap;
    cursor: pointer;
    color:#fff;
    background-color: #409eff;
    border-color: #409eff;
    -webkit-appearance: none;
    text-align: center;
    box-sizing: border-box;
    outline: none;
    margin: 0;
    transition: .1s;
    font-weight: 500;
    -moz-user-select: none;
    -webkit-user-select: none;
    -ms-user-select: none;
    padding: 12px 20px;
    font-size: 14px;
    border-radius: 4px;
    margin-bottom: 30px;
    width: 200px;
  }
</style>
</html>
